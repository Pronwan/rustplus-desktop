<Window x:Class="RustPlusDesk.Views.DeviceImportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Rust+ Desk – Import Devices"
        Width="720"
        Height="540"
        Background="{DynamicResource AppBg}"
        Foreground="{DynamicResource TextPrimary}"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        AllowsTransparency="False"
        ShowInTaskbar="False">

    <Border Background="{DynamicResource Surface}"
            BorderBrush="{DynamicResource CardBorder}"
            BorderThickness="1"
            CornerRadius="{DynamicResource Radius}"
            Padding="14"
            Margin="8">

        <DockPanel LastChildFill="True">

            <!-- Header -->
            <StackPanel DockPanel.Dock="Top" Margin="0,0,0,12">
                <TextBlock Text="Import devices"
                           FontSize="20"
                           FontWeight="SemiBold"
                           Margin="0,0,0,2"/>

                <!-- e.g. 'Source: devices_export_rustoria-main.json' -->
                <TextBlock Text="{Binding SourceDescription}"
                           Foreground="{DynamicResource Accent}"
                           FontSize="11"
                           Margin="0,0,0,4"/>

                <!-- e.g. 'Select which devices you want to import for this server.' -->
                <TextBlock Text="Select which devices you want to import for this server."
                           Foreground="{DynamicResource TextSubtle}"
                           FontSize="13"/>
            </StackPanel>

            <!-- Bottom command bar -->
            <Border DockPanel.Dock="Bottom"
                    Margin="0,12,0,0"
                    Padding="0,8,0,0"
                    BorderThickness="1,1,0,0"
                    BorderBrush="{DynamicResource CardBorder}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Left side: selection helpers -->
                    <StackPanel Orientation="Horizontal"
            VerticalAlignment="Center">
                        <Button Content="Select all"
            Click="BtnSelectAll_Click" />
                        <Button Content="Deselect all"
            Margin="8,0,0,0"
            Click="BtnDeselectAll_Click" />
                        <Button Content="Check device status"
            Margin="16,0,0,0"
            Click="BtnCheckStatus_Click" />
                    </StackPanel>

                    <!-- Right side: main actions -->
                    <StackPanel Orientation="Horizontal"
            Grid.Column="1"
            VerticalAlignment="Center">
                        <Button Content="Cancel"
            IsCancel="True"
            Click="BtnCancel_Click" />
                        <Button Content="Import selected"
            IsDefault="True"
            Click="BtnImport_Click"
            Margin="8,0,0,0" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Scrollable main content -->
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          CanContentScroll="False"
                          ScrollViewer.PanningMode="VerticalOnly">

                <StackPanel Orientation="Vertical" Margin="0,0,0,4">

                    <!-- Summary text, e.g. '5 devices found in file, 3 selected.' -->
                    <TextBlock Text="{Binding SummaryText}"
                               FontSize="12"
                               Foreground="{DynamicResource TextSubtle}"
                               Margin="0,0,0,8" />

                    <!-- Device list -->
                    <ItemsControl ItemsSource="{Binding Devices}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SurfaceAlt}"
        BorderBrush="{DynamicResource CardBorder}"
        BorderThickness="1"
        CornerRadius="10"
        Padding="10"
        Margin="0,0,0,8">

                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Opacity" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding AlreadyPresent}" Value="True">
                                                    <Setter Property="Opacity" Value="0.4"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <!-- checkbox -->
                                            <ColumnDefinition Width="Auto" />
                                            <!-- icon -->
                                            <ColumnDefinition Width="*"   />
                                            <!-- text -->
                                            <ColumnDefinition Width="Auto"/>
                                            <!-- right side -->
                                        </Grid.ColumnDefinitions>

                                        <!-- Selection checkbox -->
                                        <CheckBox Style="{StaticResource DotCheckBox}"
              IsChecked="{Binding IsSelected}"
              IsEnabled="{Binding IsSelectable}"                                    
              VerticalAlignment="Top"
              Margin="0,2,8,0" />

                                        <!-- Device icon -->
                                        <Image Grid.Column="1"
           Width="20"
           Height="20"
           Margin="0,2,8,0">
                                            <Image.Style>
                                                <Style TargetType="Image">
                                                    <!-- fallback, falls Kind null/unbekannt -->
                                                    <Setter Property="Source" Value="/icons/smartswitch.png" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Kind}" Value="SmartAlarm">
                                                            <Setter Property="Source" Value="/icons/smartalarm.png" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Kind}" Value="SmartSwitch">
                                                            <Setter Property="Source" Value="/icons/smartswitch.png" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Kind}" Value="StorageMonitor">
                                                            <Setter Property="Source" Value="/icons/storagemonitor.png" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>

                                        <!-- Device main info -->
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="{Binding DisplayName}"
           FontWeight="SemiBold"
           FontSize="13">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground"
                    Value="{DynamicResource TextPrimary}" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding ExistsState}" Value="missing">
                                                                <Setter Property="Foreground" Value="Tomato" />
                                                                <Setter Property="FontStyle" Value="Italic" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>

                                            <!-- usw. wie gehabt -->
                                        </StackPanel>

                                        <!-- Right side: extra details -->
                                        <StackPanel Grid.Column="3"
                VerticalAlignment="Center"
                HorizontalAlignment="Right">
                                            <TextBlock Text="{Binding ExtraInfo}"
                   Foreground="{DynamicResource TextSubtle}"
                   FontSize="11"
                   TextAlignment="Right"
                   TextWrapping="Wrap" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

        </DockPanel>
    </Border>
</Window>